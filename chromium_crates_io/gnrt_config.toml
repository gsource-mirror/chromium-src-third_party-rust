# Copyright 2023 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This file configures how to generate GN rules for third-party Rust crates.
#
# allow_first_party_usage: If false, the crate should not be visible to first
#   party code even though it is present in the Cargo.toml file. It defaults to
#   true. Use this if you need to control features for a crate that is only
#   meant for use as a transitive dependency of third-party crates.
#   e.g. allow_first_party_usage = false
#
# build_script_outputs: A list of file paths, rooted from where the BUILD.gn
#   file is located, of files generated by the crate's build script.
#   e.g. build_script_outputs = [ "crate/src/gen/gen_stuff.rs" ]
#
# group: One of 'safe', 'sandbox', or 'test. This indicates where the library
#   is allowed to be used and where its GN rules will be written.
#   TODO(danakj): What is the default? It should probably be 'sandbox'?
#
#   'safe': The library satisfies the rule-of-2 and can be used in any process.
#   'sandbox': The library does not satisfy the rule-of-2 and must be used in
#              a sandboxed process such as the renderer or a utility process.
#   'test': The library is only used in tests.

[gn]
build_file_template = "BUILD.gn.hbs"

[resolve]
root = "chromium"
remove_crates = ['cc', 'link-cplusplus']

[crate.anyhow]
group = 'test'

[crate.clap]
# These files are included from source files and are thus required as part of
# building the crate.
extra_input_roots = ['../README.md']
extra_src_roots = ['../examples']

[crate.clap_builder]
extra_input_roots = ['../README.md']

[crate.cxx]
remove_deps = ['cc', 'link-cplusplus']
# This removes the use of cc, and disables the `build_with_cargo` cfg which
# also removes the use of link-cplusplus.
remove_build_rs = true

[crate.hex]
group = 'test'

[crate.hex-literal]
group = 'test'

[crate.log]
group = 'test'

[crate.rand]
group = 'test'

[crate.rand_pcg]
group = 'test'

[crate.read-fonts]
extra_src_roots = ['../generated']

[crate.regex]
group = 'test'

[crate.rstest]
group = 'test'

[crate.rstest_reuse]
group = 'test'

[crate.rustversion]
allow_first_party_usage = false
build_script_outputs = [ "version.rs" ]

[crate.serde_json]
group = 'test'

[crate.small_ctor]
group = 'test'

[crate.unicode-linebreak]
allow_first_party_usage = false
build_script_outputs = [ "tables.rs" ]

[crate.wycheproof]
group = 'test'
