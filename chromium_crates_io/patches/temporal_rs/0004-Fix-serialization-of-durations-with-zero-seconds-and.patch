From 99e3ad19df4642bdef57372958bb373ae39eab16 Mon Sep 17 00:00:00 2001
From: Manish Goregaokar <manishearth@google.com>
Date: Thu, 6 Nov 2025 21:58:05 +0000
Subject: [PATCH] Fix serialization of durations with zero seconds and nonzero
 subseconds

Uplifts https://github.com/boa-dev/temporal/pull/610

Change-Id: Ia571f6bcac5a11264b69f5ffd9209c98eceecb2c
---
 .../src/builtins/core/duration/tests.rs       |  6 ++++++
 .../vendor/temporal_rs-v0_1/src/parsers.rs    | 21 +++++++++++++++++--
 2 files changed, 25 insertions(+), 2 deletions(-)

diff --git a/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/builtins/core/duration/tests.rs b/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/builtins/core/duration/tests.rs
index 6ef0453e11792..5eae2888ba21f 100644
--- a/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/builtins/core/duration/tests.rs
+++ b/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/builtins/core/duration/tests.rs
@@ -73,6 +73,12 @@ fn duration_to_string_auto_precision() {
         .as_temporal_string(ToStringRoundingOptions::default())
         .unwrap();
     assert_eq!(&result, "P1Y2M3W4DT5H6M7.98765S");
+
+    let duration = Duration::new(0, 0, 0, 2, 0, 0, 0, 0, 0, 1).unwrap();
+    let result = duration
+        .as_temporal_string(ToStringRoundingOptions::default())
+        .unwrap();
+    assert_eq!(&result, "P2DT0.000000001S");
 }
 
 #[test]
diff --git a/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/parsers.rs b/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/parsers.rs
index 43a7d778802a5..20a3d6c796b92 100644
--- a/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/parsers.rs
+++ b/third_party/rust/chromium_crates_io/vendor/temporal_rs-v0_1/src/parsers.rs
@@ -594,6 +594,7 @@ impl Writeable for FormattableDuration {
                     let unit_below_minute = self.date.is_none() && hours == 0 && minutes == 0;
 
                     let write_second = seconds != 0
+                        || ns != 0
                         || unit_below_minute
                         || matches!(self.precision, Precision::Digit(_));
 
@@ -899,11 +900,27 @@ pub fn parse_allowed_calendar_formats(s: &[u8]) -> Option<&[u8]> {
 
 #[cfg(test)]
 mod tests {
-    use super::{FormattableDate, FormattableOffset};
-    use crate::parsers::{FormattableTime, Precision};
+    use super::{FormattableDate, FormattableDuration, FormattableOffset};
+    use crate::parsers::{FormattableTime, FormattableTimeDuration, Precision};
     use alloc::format;
     use writeable::assert_writeable_eq;
 
+    #[test]
+    fn duration() {
+        let duration = FormattableDuration {
+            sign: crate::Sign::Positive,
+            date: Some(super::FormattableDateDuration {
+                years: 1,
+                months: 0,
+                weeks: 0,
+                days: 0,
+            }),
+            time: Some(FormattableTimeDuration::Seconds(0, 0, 0, Some(1))),
+            precision: Precision::Auto,
+        };
+        assert_writeable_eq!(duration, "P1YT0.000000001S");
+    }
+
     #[test]
     fn offset_string() {
         let offset = FormattableOffset {
-- 
2.51.2.1041.gc1ab5b90ca-goog

