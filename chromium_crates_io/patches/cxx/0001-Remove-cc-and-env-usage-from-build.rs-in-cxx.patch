From 869775e6d3e7a076d120146ca346b0738043bcae Mon Sep 17 00:00:00 2001
From: Adrian Taylor <adetaylor@chromium.org>
Date: Wed, 8 Nov 2023 16:58:53 +0000
Subject: [PATCH 1/4] Remove cc and cxxbridge_flags from build.rs.

Change-Id: Ia27cc1eb203f30a47b166b37c3049c42f4deef84
---
 third_party/rust/cxx/v1/crate/Cargo.toml | 20 +++++++-------
 third_party/rust/cxx/v1/crate/build.rs   | 33 ++++++++++++------------
 2 files changed, 28 insertions(+), 25 deletions(-)

diff --git a/third_party/rust/cxx/v1/crate/Cargo.toml b/third_party/rust/cxx/v1/crate/Cargo.toml
index 10d6edf33a157..abcdac8751a94 100644
--- a/third_party/rust/cxx/v1/crate/Cargo.toml
+++ b/third_party/rust/cxx/v1/crate/Cargo.toml
@@ -91,20 +91,22 @@ version = "1.0.13"
 version = "1.0.81"
 features = ["diff"]
 
-[build-dependencies.cc]
-version = "1.0.79"
+# Removed for Chromium build
+# [build-dependencies.cc]
+# version = "1.0.79"
 
-[build-dependencies.cxxbridge-flags]
-version = "=1.0.110"
-default-features = false
+# Removed for Chromium build
+# [build-dependencies.cxxbridge-flags]
+# version = "=1.0.110"
+# default-features = false
 
 [features]
 alloc = []
-"c++14" = ["cxxbridge-flags/c++14"]
-"c++17" = ["cxxbridge-flags/c++17"]
-"c++20" = ["cxxbridge-flags/c++20"]
+# "c++14" = ["cxxbridge-flags/c++14"]
+# "c++17" = ["cxxbridge-flags/c++17"]
+# "c++20" = ["cxxbridge-flags/c++20"]
 default = [
     "std",
-    "cxxbridge-flags/default",
+    # "cxxbridge-flags/default",
 ]
 std = ["alloc"]
diff --git a/third_party/rust/cxx/v1/crate/build.rs b/third_party/rust/cxx/v1/crate/build.rs
index afcfea3b081fd..ee7c7ad4094c2 100644
--- a/third_party/rust/cxx/v1/crate/build.rs
+++ b/third_party/rust/cxx/v1/crate/build.rs
@@ -3,25 +3,26 @@ use std::path::{Path, PathBuf};
 use std::process::Command;
 
 fn main() {
-    let manifest_dir_opt = env::var_os("CARGO_MANIFEST_DIR").map(PathBuf::from);
-    let manifest_dir = manifest_dir_opt.as_deref().unwrap_or(Path::new(""));
+    // Removed for Chromium build
+    //let manifest_dir_opt = env::var_os("CARGO_MANIFEST_DIR").map(PathBuf::from);
+    //let manifest_dir = manifest_dir_opt.as_deref().unwrap_or(Path::new(""));
 
-    cc::Build::new()
-        .file(manifest_dir.join("src/cxx.cc"))
-        .cpp(true)
-        .cpp_link_stdlib(None) // linked via link-cplusplus crate
-        .flag_if_supported(cxxbridge_flags::STD)
-        .warnings_into_errors(cfg!(deny_warnings))
-        .compile("cxxbridge1");
+    //cc::Build::new()
+        //.file(manifest_dir.join("src/cxx.cc"))
+        //.cpp(true)
+        //.cpp_link_stdlib(None) // linked via link-cplusplus crate
+        //.flag_if_supported(cxxbridge_flags::STD)
+        //.warnings_into_errors(cfg!(deny_warnings))
+        //.compile("cxxbridge1");
 
-    println!("cargo:rerun-if-changed=src/cxx.cc");
-    println!("cargo:rerun-if-changed=include/cxx.h");
-    println!("cargo:rustc-cfg=built_with_cargo");
+    //println!("cargo:rerun-if-changed=src/cxx.cc");
+    //println!("cargo:rerun-if-changed=include/cxx.h");
+    //println!("cargo:rustc-cfg=built_with_cargo");
 
-    if let Some(manifest_dir) = &manifest_dir_opt {
-        let cxx_h = manifest_dir.join("include").join("cxx.h");
-        println!("cargo:HEADER={}", cxx_h.to_string_lossy());
-    }
+    //if let Some(manifest_dir) = &manifest_dir_opt {
+        //let cxx_h = manifest_dir.join("include").join("cxx.h");
+        //println!("cargo:HEADER={}", cxx_h.to_string_lossy());
+    //}
 
     if let Some(rustc) = rustc_version() {
         if rustc.minor < 60 {
-- 
2.42.0.869.gea05f2083d-goog

